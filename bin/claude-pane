#!/bin/bash
# Claude pane-aware launcher - uses pane title if set, else window:pane_index

flags="--dangerously-skip-permissions"

if [[ -n "$TMUX" ]]; then
  pane_title=$(tmux display-message -p '#{pane_title}')
  window=$(tmux display-message -p '#W')
  pane_idx=$(tmux display-message -p '#P')
  hostname_short=$(hostname -s)

  # prefer pane title if explicitly set (not default hostname)
  if [[ -n "$pane_title" && "$pane_title" != "$hostname_short" && "$pane_title" != "bash" && "$pane_title" != "zsh" ]]; then
    key="title:${pane_title}"
  else
    key="${window}:${pane_idx}"
  fi

  session_file="$HOME/.claude/pane-sessions/$key"

  if [[ -f "$session_file" ]]; then
    session_id=$(cat "$session_file")
    echo "resuming $key"
    exec claude $flags --resume "$session_id"
  fi
fi

echo "no saved session, starting fresh"
exec claude $flags
